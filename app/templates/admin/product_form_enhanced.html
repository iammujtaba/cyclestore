{% extends "admin_base.html" %}

{% block title %}{{ 'Edit' if product else 'Add' }} {{ product_type|title }} - Admin Panel{% endblock %}

{% block head %}
    <style>
        .admin-content {
            background: #f8fafc;
            min-height: 100vh;
            padding-top: 2rem;
        }
        
        .form-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .form-header {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .form-body {
            padding: 2rem;
        }
        
        .form-tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 2rem;
        }
        
        .tab-button {
            flex: 1;
            padding: 1rem;
            background: #f3f4f6;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s;
        }
        
        .tab-button.active {
            background: #dc2626;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group.full-width {
            grid-column: span 2;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        
        .image-section {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            background: #f9fafb;
            margin-bottom: 2rem;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .image-item {
            position: relative;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        
        .image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .image-controls {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.25rem;
        }
        
        .image-btn {
            width: 2rem;
            height: 2rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }
        
        .btn-primary {
            background: #dc2626;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            border-color: #dc2626;
            background: #fef2f2;
        }
        
        .upload-area.dragover {
            border-color: #dc2626;
            background: #fef2f2;
        }
        
        .features-container {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            background: #f9fafb;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .feature-item input {
            flex: 1;
            margin-right: 0.5rem;
            margin-bottom: 0;
        }
        
        .remove-feature {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.75rem;
        }
        
        .add-feature {
            background: #10b981;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            padding-top: 2rem;
            border-top: 2px solid #e5e7eb;
            margin-top: 2rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: #dc2626;
            color: white;
        }
        
        .btn-primary:hover {
            background: #b91c1c;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
        }
        
        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #059669;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .required {
            color: #ef4444;
        }
        
        .upload-progress {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 1rem;
        }
        
        .upload-progress-bar {
            height: 100%;
            background: #10b981;
            transition: width 0.3s;
        }
    </style>
{% endblock %}

{% block content %}
<div class="admin-content">
    <!-- Admin Header -->
    <div class="admin-header">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-{{ 'bicycle' if product_type == 'bicycle' else 'tools' }} mr-2 text-red-600"></i>
                        {{ 'Edit' if product else 'Add' }} {{ product_type|title }}
                    </h1>
                    <p class="text-gray-600">{{ 'Update' if product else 'Create a new' }} {{ product_type }} in your inventory</p>
                    {% if product %}
                        <p class="text-xs text-gray-500 mt-1">ID: {{ product.id }} | Created: {{ product.created_at.strftime('%Y-%m-%d') if product.created_at else 'N/A' }}</p>
                    {% endif %}
                </div>
                <div>
                    <a href="/admin/products" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-arrow-left mr-1"></i>Back to Products
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6">
        <div class="form-container">
            <div class="form-header">
        
        <div class="form-body">
            {% if error %}
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle mr-2"></i>{{ error }}
                </div>
            {% endif %}
            
            {% if success %}
                <div class="success-message">
                    <i class="fas fa-check-circle mr-2"></i>{{ success }}
                </div>
            {% endif %}
            
            <form id="productForm" method="POST" action="{{ '/admin/products/' + product_type + '/' + product.id|string + '/update' if product else '/admin/products/create' }}" enctype="multipart/form-data">
                <input type="hidden" name="product_type" value="{{ product_type }}">
                
                <!-- Tabs -->
                <div class="form-tabs">
                    <button type="button" class="tab-button active" data-tab="basic">
                        <i class="fas fa-info-circle mr-2"></i>Basic Info
                    </button>
                    <button type="button" class="tab-button" data-tab="details">
                        <i class="fas fa-cogs mr-2"></i>Details
                    </button>
                    <button type="button" class="tab-button" data-tab="images">
                        <i class="fas fa-images mr-2"></i>Images
                    </button>
                    <button type="button" class="tab-button" data-tab="inventory">
                        <i class="fas fa-warehouse mr-2"></i>Inventory
                    </button>
                </div>
                
                <!-- Basic Info Tab -->
                <div class="tab-content active" id="basic">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="name">
                                <i class="fas fa-tag mr-1"></i>Product Name <span class="required">*</span>
                            </label>
                            <input type="text" 
                                   id="name" 
                                   name="name" 
                                   value="{{ product.name if product else '' }}"
                                   required 
                                   placeholder="Enter product name">
                        </div>
                        
                        <div class="form-group">
                            <label for="brand">
                                <i class="fas fa-industry mr-1"></i>Brand <span class="required">*</span>
                            </label>
                            <input type="text" 
                                   id="brand" 
                                   name="brand" 
                                   value="{{ product.brand if product else 'Supreme' }}"
                                   required 
                                   placeholder="Enter brand name">
                        </div>
                        
                        <div class="form-group">
                            <label for="category">
                                <i class="fas fa-th-large mr-1"></i>Category <span class="required">*</span>
                            </label>
                            <select id="category" name="category" required>
                                <option value="">Select Category</option>
                                {% if product_type == 'bicycle' %}
                                    <option value="mountain" {{ 'selected' if product and product.category == 'mountain' }}>Mountain Bike</option>
                                    <option value="road" {{ 'selected' if product and product.category == 'road' }}>Road Bike</option>
                                    <option value="hybrid" {{ 'selected' if product and product.category == 'hybrid' }}>Hybrid Bike</option>
                                    <option value="electric" {{ 'selected' if product and product.category == 'electric' }}>Electric Bike</option>
                                    <option value="city" {{ 'selected' if product and product.category == 'city' }}>City Bike</option>
                                    <option value="kids" {{ 'selected' if product and product.category == 'kids' }}>Kids Bike</option>
                                    <option value="folding" {{ 'selected' if product and product.category == 'folding' }}>Folding Bike</option>
                                {% else %}
                                    <option value="safety" {{ 'selected' if product and product.category == 'safety' }}>Safety</option>
                                    <option value="parts" {{ 'selected' if product and product.category == 'parts' }}>Parts</option>
                                    <option value="tools" {{ 'selected' if product and product.category == 'tools' }}>Tools</option>
                                    <option value="maintenance" {{ 'selected' if product and product.category == 'maintenance' }}>Maintenance</option>
                                    <option value="lighting" {{ 'selected' if product and product.category == 'lighting' }}>Lighting</option>
                                    <option value="storage" {{ 'selected' if product and product.category == 'storage' }}>Storage</option>
                                {% endif %}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="price">
                                <i class="fas fa-rupee-sign mr-1"></i>Price (â‚¹) <span class="required">*</span>
                            </label>
                            <input type="number" 
                                   id="price" 
                                   name="price" 
                                   value="{{ product.price if product else '' }}"
                                   required 
                                   min="0"
                                   step="0.01"
                                   placeholder="Enter price">
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="description">
                                <i class="fas fa-align-left mr-1"></i>Description
                            </label>
                            <textarea id="description" 
                                      name="description" 
                                      rows="4"
                                      placeholder="Enter product description">{{ product.description if product else '' }}</textarea>
                        </div>
                        
                        <div class="form-group full-width">
                            <label>
                                <i class="fas fa-star mr-1"></i>Features
                            </label>
                            <div class="features-container">
                                <div id="features-list">
                                    {% if product and product.features %}
                                        {% for feature in product.features %}
                                            <div class="feature-item">
                                                <input type="text" name="features[]" value="{{ feature }}" placeholder="Enter feature">
                                                <button type="button" class="remove-feature" onclick="removeFeature(this)">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="feature-item">
                                            <input type="text" name="features[]" placeholder="Enter feature">
                                            <button type="button" class="remove-feature" onclick="removeFeature(this)">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    {% endif %}
                                </div>
                                <button type="button" class="add-feature" onclick="addFeature()">
                                    <i class="fas fa-plus mr-1"></i>Add Feature
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Details Tab -->
                <div class="tab-content" id="details">
                    <div class="form-grid">
                        {% if product_type == 'bicycle' %}
                            <div class="form-group">
                                <label for="frame_size">
                                    <i class="fas fa-expand-arrows-alt mr-1"></i>Frame Size
                                </label>
                                <select id="frame_size" name="frame_size">
                                    <option value="">Select Frame Size</option>
                                    <option value="XS" {{ 'selected' if product and product.frame_size == 'XS' }}>XS (Extra Small)</option>
                                    <option value="S" {{ 'selected' if product and product.frame_size == 'S' }}>S (Small)</option>
                                    <option value="M" {{ 'selected' if product and product.frame_size == 'M' }}>M (Medium)</option>
                                    <option value="L" {{ 'selected' if product and product.frame_size == 'L' }}>L (Large)</option>
                                    <option value="XL" {{ 'selected' if product and product.frame_size == 'XL' }}>XL (Extra Large)</option>
                                    <option value="XXL" {{ 'selected' if product and product.frame_size == 'XXL' }}>XXL (Extra Extra Large)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="wheel_size">
                                    <i class="fas fa-circle-notch mr-1"></i>Wheel Size
                                </label>
                                <select id="wheel_size" name="wheel_size">
                                    <option value="">Select Wheel Size</option>
                                    <option value="20\"" {{ 'selected' if product and product.wheel_size == '20"' }}>20"</option>
                                    <option value="24\"" {{ 'selected' if product and product.wheel_size == '24"' }}>24"</option>
                                    <option value="26\"" {{ 'selected' if product and product.wheel_size == '26"' }}>26"</option>
                                    <option value="27.5\"" {{ 'selected' if product and product.wheel_size == '27.5"' }}>27.5"</option>
                                    <option value="29\"" {{ 'selected' if product and product.wheel_size == '29"' }}>29"</option>
                                    <option value="700c" {{ 'selected' if product and product.wheel_size == '700c' }}>700c</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="gear_count">
                                    <i class="fas fa-cog mr-1"></i>Gear Count
                                </label>
                                <input type="number" 
                                       id="gear_count" 
                                       name="gear_count" 
                                       value="{{ product.gear_count if product else '' }}"
                                       min="1"
                                       max="50"
                                       placeholder="Number of gears">
                            </div>
                            
                            <div class="form-group">
                                <label for="brake_type">
                                    <i class="fas fa-hand-paper mr-1"></i>Brake Type
                                </label>
                                <select id="brake_type" name="brake_type">
                                    <option value="">Select Brake Type</option>
                                    <option value="Rim Brakes" {{ 'selected' if product and product.brake_type == 'Rim Brakes' }}>Rim Brakes</option>
                                    <option value="Disc Brakes" {{ 'selected' if product and product.brake_type == 'Disc Brakes' }}>Disc Brakes</option>
                                    <option value="Hydraulic Disc" {{ 'selected' if product and product.brake_type == 'Hydraulic Disc' }}>Hydraulic Disc</option>
                                    <option value="Mechanical Disc" {{ 'selected' if product and product.brake_type == 'Mechanical Disc' }}>Mechanical Disc</option>
                                    <option value="V-Brakes" {{ 'selected' if product and product.brake_type == 'V-Brakes' }}>V-Brakes</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="suspension">
                                    <i class="fas fa-arrows-alt-v mr-1"></i>Suspension
                                </label>
                                <select id="suspension" name="suspension">
                                    <option value="">Select Suspension</option>
                                    <option value="None" {{ 'selected' if product and product.suspension == 'None' }}>None (Rigid)</option>
                                    <option value="Front" {{ 'selected' if product and product.suspension == 'Front' }}>Front Suspension</option>
                                    <option value="Full" {{ 'selected' if product and product.suspension == 'Full' }}>Full Suspension</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="size">
                                    <i class="fas fa-ruler mr-1"></i>Size/Model
                                </label>
                                <input type="text" 
                                       id="size" 
                                       name="size" 
                                       value="{{ product.size if product else '' }}"
                                       placeholder="e.g., Medium, Large, 26 inch">
                            </div>
                        {% else %}
                            <div class="form-group">
                                <label for="accessory_type">
                                    <i class="fas fa-cube mr-1"></i>Accessory Type
                                </label>
                                <input type="text" 
                                       id="accessory_type" 
                                       name="accessory_type" 
                                       value="{{ product.accessory_type if product else '' }}"
                                       placeholder="e.g., helmet, light, lock">
                            </div>
                            
                            <div class="form-group">
                                <label for="compatibility">
                                    <i class="fas fa-link mr-1"></i>Compatibility
                                </label>
                                <input type="text" 
                                       id="compatibility" 
                                       name="compatibility" 
                                       value="{{ product.compatibility if product else '' }}"
                                       placeholder="e.g., Universal, Mountain bikes, 26 inch wheels">
                            </div>
                            
                            <div class="form-group">
                                <label for="size">
                                    <i class="fas fa-ruler mr-1"></i>Size
                                </label>
                                <input type="text" 
                                       id="size" 
                                       name="size" 
                                       value="{{ product.size if product else '' }}"
                                       placeholder="e.g., Small, Medium, Large, One Size">
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Images Tab -->
                <div class="tab-content" id="images">
                    <div class="image-section">
                        <h3 class="text-lg font-semibold mb-4">
                            <i class="fas fa-images mr-2"></i>Product Images
                        </h3>
                        
                        <!-- Current Images -->
                        {% if product %}
                            <div id="current-images" class="image-grid">
                                <!-- Current images will be loaded via JavaScript -->
                            </div>
                        {% endif %}
                        
                        <!-- Upload Area -->
                        <div class="upload-area" onclick="document.getElementById('image-upload').click()">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                            <p class="text-lg font-semibold text-gray-600">Click to upload images</p>
                            <p class="text-sm text-gray-500">or drag and drop images here</p>
                            <p class="text-xs text-gray-400 mt-2">Supports: JPG, PNG, GIF (Max 5MB each)</p>
                        </div>
                        
                        <input type="file" 
                               id="image-upload" 
                               name="images[]" 
                               multiple 
                               accept="image/*" 
                               style="display: none;">
                        
                        <div id="upload-progress" class="upload-progress" style="display: none;">
                            <div class="upload-progress-bar" style="width: 0%;"></div>
                        </div>
                        
                        <!-- Preview Area -->
                        <div id="image-preview" class="image-grid" style="margin-top: 1rem;"></div>
                    </div>
                </div>
                
                <!-- Inventory Tab -->
                <div class="tab-content" id="inventory">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="stock_quantity">
                                <i class="fas fa-boxes mr-1"></i>Stock Quantity <span class="required">*</span>
                            </label>
                            <input type="number" 
                                   id="stock_quantity" 
                                   name="stock_quantity" 
                                   value="{{ product.stock_quantity if product else '10' }}"
                                   required 
                                   min="0"
                                   placeholder="Enter stock quantity">
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-toggle-on mr-1"></i>Product Status
                            </label>
                            <div class="checkbox-group">
                                <input type="checkbox" 
                                       id="in_stock" 
                                       name="in_stock" 
                                       {{ 'checked' if product and product.in_stock else 'checked' }}>
                                <label for="in_stock">In Stock</label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-star mr-1"></i>Featured Product
                            </label>
                            <div class="checkbox-group">
                                <input type="checkbox" 
                                       id="is_featured" 
                                       name="is_featured" 
                                       {{ 'checked' if product and product.is_featured }}>
                                <label for="is_featured">Mark as featured</label>
                            </div>
                        </div>
                        
                        {% if product %}
                            <div class="form-group">
                                <label>
                                    <i class="fas fa-calendar mr-1"></i>Created Date
                                </label>
                                <input type="text" 
                                       value="{{ product.created_at.strftime('%Y-%m-%d %H:%M') if product.created_at else 'N/A' }}" 
                                       readonly 
                                       class="bg-gray-100">
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <i class="fas fa-edit mr-1"></i>Last Updated
                                </label>
                                <input type="text" 
                                       value="{{ product.updated_at.strftime('%Y-%m-%d %H:%M') if product.updated_at else 'N/A' }}" 
                                       readonly 
                                       class="bg-gray-100">
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="form-actions">
                    <a href="/admin/products" class="btn btn-secondary">
                        <i class="fas fa-times mr-1"></i>Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save mr-1"></i>{{ 'Update' if product else 'Create' }} Product
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Tab functionality
document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', function() {
        const tabName = this.getAttribute('data-tab');
        
        // Remove active class from all tabs and contents
        document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // Add active class to clicked tab and corresponding content
        this.classList.add('active');
        document.getElementById(tabName).classList.add('active');
    });
});

// Features management
function addFeature() {
    const featuresList = document.getElementById('features-list');
    const featureItem = document.createElement('div');
    featureItem.className = 'feature-item';
    featureItem.innerHTML = `
        <input type="text" name="features[]" placeholder="Enter feature">
        <button type="button" class="remove-feature" onclick="removeFeature(this)">
            <i class="fas fa-times"></i>
        </button>
    `;
    featuresList.appendChild(featureItem);
}

function removeFeature(button) {
    const featuresList = document.getElementById('features-list');
    if (featuresList.children.length > 1) {
        button.parentElement.remove();
    }
}

// Image upload and management
{% if product %}
// Load current images
function loadCurrentImages() {
    fetch(`/product-images/{{ product_type }}/{{ product.id }}`)
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('current-images');
            container.innerHTML = '';
            
            if (data.images && data.images.length > 0) {
                data.images.forEach((imagePath, index) => {
                    const imageItem = document.createElement('div');
                    imageItem.className = 'image-item';
                    imageItem.innerHTML = `
                        <img src="${imagePath}" alt="Product Image ${index + 1}">
                        <div class="image-controls">
                            <button type="button" class="image-btn btn-primary" onclick="setPrimaryImage('${imagePath}')" title="Set as primary">
                                <i class="fas fa-star"></i>
                            </button>
                            <button type="button" class="image-btn btn-danger" onclick="deleteImage('${imagePath}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(imageItem);
                });
            }
        })
        .catch(error => console.error('Error loading images:', error));
}

// Set primary image
function setPrimaryImage(imagePath) {
    // Implementation for setting primary image
    console.log('Setting primary image:', imagePath);
}

// Delete image
function deleteImage(imagePath) {
    if (confirm('Are you sure you want to delete this image?')) {
        // Implementation for deleting image
        console.log('Deleting image:', imagePath);
    }
}

// Load images when page loads
document.addEventListener('DOMContentLoaded', loadCurrentImages);
{% endif %}

// File upload handling
const uploadArea = document.querySelector('.upload-area');
const fileInput = document.getElementById('image-upload');
const previewContainer = document.getElementById('image-preview');

uploadArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    this.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', function(e) {
    e.preventDefault();
    this.classList.remove('dragover');
});

uploadArea.addEventListener('drop', function(e) {
    e.preventDefault();
    this.classList.remove('dragover');
    
    const files = e.dataTransfer.files;
    handleFiles(files);
});

fileInput.addEventListener('change', function(e) {
    handleFiles(this.files);
});

function handleFiles(files) {
    previewContainer.innerHTML = '';
    
    Array.from(files).forEach((file, index) => {
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                imageItem.innerHTML = `
                    <img src="${e.target.result}" alt="Preview ${index + 1}">
                    <div class="image-controls">
                        <button type="button" class="image-btn btn-danger" onclick="removePreview(this)" title="Remove">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                previewContainer.appendChild(imageItem);
            };
            reader.readAsDataURL(file);
        }
    });
}

function removePreview(button) {
    button.closest('.image-item').remove();
}

// Form validation
document.getElementById('productForm').addEventListener('submit', function(e) {
    const requiredFields = this.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.style.borderColor = '#ef4444';
            isValid = false;
        } else {
            field.style.borderColor = '#e5e7eb';
        }
    });
    
    if (!isValid) {
        e.preventDefault();
        alert('Please fill in all required fields.');
    }
});
</script>
    </div>
</div>
{% endblock %}
